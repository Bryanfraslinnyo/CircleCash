<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <title>{% block title %}My Website{% endblock %}</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">

    {% block head %}{% endblock %}
</head>
<body>
    <!-- Barre de navigation -->
    <nav>
        <a href="{{ url_for('accueil.home') }}" class="nav-logo">
            ðŸ’µ CircleCash
        </a>
        <ul class="nav-links">
            {% if session.get('user_id') %}
                <li><a href="{{ url_for('tontines.list_all') }}">Toutes les tontines</a></li>
                <li><a href="{{ url_for('tontines.my_memberships') }}">Mes tontines</a></li>
                <li><a href="{{ url_for('tableaudebord.dashboard') }}">Tableau de bord</a></li>
                <li><a href="{{ url_for('connexion.logout') }}" class="btn-login">Se dÃ©connecter</a></li>
            {% else %}
                <li><a href="{{ url_for('accueil.home') }}">Accueil</a></li>
                <li><a href="{{ url_for('inscription.sinscrire') }}">S'inscrire</a></li>
                <li><a href="{{ url_for('connexion.se_connecter') }}" class="btn-login">Se connecter</a></li>
            {% endif %}
        </ul>
    </nav>

    <!-- Profile edit modal -->
    <div id="profileModal" class="modal" style="display:none;position:fixed;inset:0;background:rgba(0,0,0,0.5);align-items:center;justify-content:center;">
        <div style="background:#fff;padding:20px;border-radius:12px;max-width:520px;width:100%;position:relative;">
            <button onclick="closeProfileModal()" style="position:absolute;right:12px;top:8px;border:none;background:transparent;font-size:20px;">âœ•</button>
            <h3 style="color:#0eaa16;margin-top:0;">Modifier mon profil</h3>
            <form action="{{ url_for('inscription.update_profile') }}" method="post" enctype="multipart/form-data">
                <div class="form-group">
                    <label for="modal_username">Nom</label>
                    <input id="modal_username" type="text" name="username" value="{{ current_user.username if current_user else '' }}" required>
                </div>
                <div class="form-group">
                    <label for="modal_email">Email</label>
                    <input id="modal_email" type="email" name="email" value="{{ current_user.email if current_user else '' }}" required>
                </div>
                <div class="form-group">
                    <label for="modal_phone">TÃ©lÃ©phone</label>
                    <input id="modal_phone" type="text" name="phone" value="{{ current_user.phone if current_user else '' }}" required>
                </div>
                <div class="form-group">
                    <label for="modal_photo">Photo de profil</label>
                    <input id="modal_photo" type="file" name="profile_photo" accept="image/*">
                </div>
                <div style="display:flex;gap:8px;justify-content:flex-end;margin-top:10px;">
                    <button type="button" class="btn-prev" onclick="closeProfileModal()">Annuler</button>
                    <button type="submit" class="btn-next">Enregistrer</button>
                </div>
            </form>
        </div>
    </div>

    <script>
        function openProfileModal(){
            document.getElementById('profileModal').style.display = 'flex';
        }
        function closeProfileModal(){
            document.getElementById('profileModal').style.display = 'none';
        }
    </script>

    <!-- Messages Flash -->
    {% with messages = get_flashed_messages() %}
        {% if messages %}
            <div class="alerts" id="alertsContainer">
                {% for message in messages %}
                    <div class="alert alert-info" onclick="this.style.display='none';">
                        <span>{{ message }}</span>
                        <button onclick="this.parentElement.style.display='none';" style="float:right;border:none;background:transparent;font-size:16px;cursor:pointer;">âœ•</button>
                    </div>
                {% endfor %}
            </div>
            <script>
                setTimeout(() => {
                    const container = document.getElementById('alertsContainer');
                    if (container) {
                        const alerts = container.querySelectorAll('.alert');
                        alerts.forEach(alert => alert.style.display = 'none');
                    }
                }, 4000);
            </script>
        {% endif %}
    {% endwith %}
    
    <!-- Contenu principal -->
    <main>
        {% block body %}{% endblock %}
    </main>
</body>
</html>